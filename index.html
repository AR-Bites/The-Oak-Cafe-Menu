<!DOCTYPE html>
<html>
<head>
  <title>The Oak Cafe - Premium AR Dining</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --gold: #D4AF37;
      --dark-green: #1A3A2F;
      --light-cream: #F5F5DC;
      --red: #B22222;
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') no-repeat center center fixed;
      background-size: cover;
      color: white;
      text-align: center;
      overflow-x: hidden;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
    }
    
    .overlay {
      background-color: rgba(26, 58, 47, 0.95);
      min-height: 100vh;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      padding: 10px 0;
    }
    
    .logo {
      height: 60px;
      margin-bottom: 8px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      max-width: 100%;
    }
    
    h1 {
      font-size: 1.8rem;
      color: var(--gold);
      margin: 8px 0 4px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      line-height: 1.2;
    }
    
    .tagline {
      font-family: 'Montserrat', sans-serif;
      font-size: 0.8rem;
      color: var(--light-cream);
      margin-bottom: 15px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    
    .food-container {
      width: 100%;
      margin: 0 auto;
      background: rgba(245, 245, 220, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      border: 1px solid var(--gold);
      flex-grow: 1;
    }
    
    model-viewer {
      width: 100%;
      height: 220px;
      margin: 12px 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin: 15px 0;
    }
    
    button {
      background: linear-gradient(135deg, var(--gold) 0%, #E8C547 100%);
      color: var(--dark-green);
      border: none;
      padding: 10px 12px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: var(--transition);
      box-shadow: 0 2px 6px rgba(212, 175, 55, 0.3);
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .ar-button {
      background: linear-gradient(135deg, var(--red) 0%, #D63B3B 100%) !important;
      color: white !important;
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 15px;
      font-weight: 600;
      animation: pulse 2s infinite;
      font-size: 0.85rem;
      width: calc(100% - 24px);
      max-width: 220px;
      border-radius: 25px !important;
    }
    
    @keyframes pulse {
      0% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.03); }
      100% { transform: translateX(-50%) scale(1); }
    }
    
    .footer {
      margin-top: 20px;
      padding: 15px;
      background: rgba(26, 58, 47, 0.95);
      border-radius: 12px 12px 0 0;
      border-top: 2px solid var(--gold);
      position: relative;
    }
    
    .footer::before {
      content: '';
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: var(--gold);
      border-radius: 2px;
    }
    
    .footer-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin: 0 auto;
    }
    
    .branding-section {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .powered-by {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .ar-bites-logo {
      height: 35px;
      transition: var(--transition);
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    
    .social-links {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .social-link {
      color: var(--gold);
      text-decoration: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 0.9rem;
    }
    
    .instagram-icon {
      width: 20px;
      height: 20px;
    }
    
    .copyright {
      font-size: 0.75rem;
      margin-top: 15px;
      color: rgba(255,255,255,0.7);
    }
    
    /* Login Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .modal-content {
      background: rgba(26, 58, 47, 0.95);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--gold);
      width: 100%;
      max-width: 320px;
    }
    
    .modal-title {
      color: var(--gold);
      margin-bottom: 15px;
      font-size: 1.2rem;
    }
    
    .input-group {
      margin-bottom: 15px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 6px;
      color: var(--light-cream);
      text-align: left;
      font-size: 0.85rem;
    }
    
    .input-group input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid var(--gold);
      background: rgba(245, 245, 220, 0.1);
      color: white;
      font-size: 1rem;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
    }
    
    /* Staff Dashboard */
    .staff-dashboard {
      display: none;
      padding: 12px;
    }
    
    .orders-list {
      margin-top: 15px;
    }
    
    .order-card {
      background: rgba(245, 245, 220, 0.1);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
      border-left: 3px solid var(--gold);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .order-id {
      color: var(--gold);
      font-weight: bold;
      font-size: 0.85rem;
    }
    
    .order-status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
    }
    
    .status-pending {
      background: rgba(255, 193, 7, 0.2);
      color: #FFC107;
    }
    
    .status-preparing {
      background: rgba(33, 150, 243, 0.2);
      color: #2196F3;
    }
    
    .status-ready {
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
    }
    
    .status-completed {
      background: rgba(158, 158, 158, 0.2);
      color: #9E9E9E;
    }
    
    .order-items {
      margin-bottom: 8px;
    }
    
    .order-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 0.85rem;
    }
    
    .order-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      flex: 1;
      padding: 6px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      min-width: 70px;
      font-size: 0.75rem;
    }
    
    /* User Type Selection */
    .user-type {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
      width: 100%;
      max-width: 280px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .user-btn {
      background: rgba(245, 245, 220, 0.1);
      color: white;
      border: 1px solid var(--gold);
      padding: 10px;
      border-radius: 25px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      font-size: 0.85rem;
    }
    
    .user-btn.active {
      background: var(--gold);
      color: var(--dark-green);
    }
    
    /* Cart System */
    .add-to-cart {
      background: linear-gradient(135deg, #2e7d32 0%, #4CAF50 100%);
      color: white;
      padding: 12px;
      border-radius: 25px;
      font-weight: 600;
      width: 100%;
      margin-top: 12px;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 2px 6px rgba(46, 125, 50, 0.3);
      font-size: 0.9rem;
    }
    
    .cart-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: calc(100% - 20px);
      max-width: 400px;
      background: rgba(26, 58, 47, 0.98);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      border: 1px solid var(--gold);
      z-index: 900;
      transform: translateX(120%);
      transition: var(--transition);
      max-height: 70vh;
      display: flex;
      flex-direction: column;
    }
    
    .cart-panel.active {
      transform: translateX(0);
    }
    
    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
    }
    
    .cart-header h3 {
      margin: 0;
      color: var(--gold);
      font-size: 1rem;
    }
    
    .cart-items {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      max-height: 40vh;
      padding-right: 5px;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .item-name {
      flex: 2;
      text-align: left;
      font-size: 0.85rem;
    }
    
    .item-price {
      flex: 1;
      text-align: right;
      color: var(--gold);
      font-size: 0.85rem;
    }
    
    .remove-item {
      background: none;
      border: none;
      color: #ff6b6b;
      cursor: pointer;
      margin-left: 6px;
      font-size: 1rem;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .cart-total {
      font-weight: bold;
      font-size: 0.9rem;
      text-align: right;
      margin: 10px 0;
      color: var(--gold);
    }
    
    .checkout-btn {
      background: linear-gradient(135deg, var(--gold) 0%, #E8C547 100%);
      color: var(--dark-green);
      width: 100%;
      padding: 12px;
      border-radius: 25px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      font-size: 0.9rem;
    }
    
    .checkout-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    .checkout-loading .checkout-text {
      visibility: hidden;
    }
    
    .checkout-loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid rgba(26, 58, 47, 0.2);
      border-top-color: var(--dark-green);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .cart-toggle {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background: var(--gold);
      color: var(--dark-green);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      z-index: 800;
      transition: var(--transition);
    }
    
    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--red);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    /* Order Status Notification */
    .order-status-notification {
      position: fixed;
      bottom: 12px;
      left: 12px;
      background: white;
      color: var(--dark-green);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(-120%);
      transition: var(--transition);
      border-left: 3px solid var(--gold);
      width: calc(100% - 24px);
      max-width: 350px;
    }
    
    .order-status-notification.active {
      transform: translateX(0);
    }
    
    .status-icon {
      width: 22px;
      height: 22px;
    }
    
    .status-content {
      flex: 1;
      text-align: left;
    }
    
    .status-title {
      font-weight: bold;
      margin-bottom: 2px;
      color: var(--dark-green);
      font-size: 0.9rem;
    }
    
    .status-message {
      font-size: 0.8rem;
      color: #555;
    }
    
    .close-status {
      background: none;
      border: none;
      color: #999;
      font-size: 1rem;
      cursor: pointer;
      margin-left: 6px;
    }

    /* Client Order Status */
    .client-orders {
      display: none;
      margin-top: 15px;
      background: rgba(245, 245, 220, 0.1);
      border-radius: 10px;
      padding: 12px;
    }

    .client-orders.active {
      display: block;
    }

    .client-orders h3 {
      color: var(--gold);
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1rem;
    }

    .client-order {
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    .client-order:last-child {
      border-bottom: none;
    }

    .client-order-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      flex-wrap: wrap;
      gap: 4px;
    }

    .client-order-id {
      color: var(--gold);
      font-weight: bold;
      font-size: 0.85rem;
    }

    .client-order-status {
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
    }

    .client-order-items {
      margin-bottom: 6px;
    }

    .client-order-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3px;
      font-size: 0.8rem;
    }

    .client-order-total {
      text-align: right;
      font-weight: bold;
      color: var(--gold);
      font-size: 0.85rem;
    }

    .view-orders-btn {
      margin-top: 12px;
      background: rgba(245, 245, 220, 0.1);
      color: white;
      border: 1px solid var(--gold);
      padding: 10px;
      border-radius: 25px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      font-size: 0.85rem;
    }

    /* Table Number Modal */
    .table-number-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1100;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .table-number-content {
      background: rgba(26, 58, 47, 0.95);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--gold);
      width: 100%;
      max-width: 320px;
    }
    
    .table-number-title {
      color: var(--gold);
      margin-bottom: 15px;
      font-size: 1.2rem;
    }
    
    .table-number-input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid var(--gold);
      background: rgba(245, 245, 220, 0.1);
      color: white;
      font-size: 1rem;
      margin-bottom: 15px;
      text-align: center;
    }
    
    /* Delete button for staff */
    .delete-order {
      background: var(--red) !important;
      color: white !important;
      margin-top: 8px;
      width: 100%;
      padding: 8px;
      font-size: 0.8rem;
    }

    /* Counter between nav buttons */
    #counter {
      color: var(--gold);
      font-weight: bold;
      font-size: 0.85rem;
      min-width: 40px;
    }

    /* Close cart button */
    #close-cart {
      background: none;
      border: none;
      color: var(--gold);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Media Queries for Larger Screens */
    @media (min-width: 768px) {
      .overlay {
        padding: 20px;
      }
      
      .logo {
        height: 70px;
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .tagline {
        font-size: 0.95rem;
      }
      
      .food-container {
        padding: 20px;
        border-radius: 15px;
      }
      
      model-viewer {
        height: 280px;
      }
      
      .nav-buttons {
        gap: 12px;
      }
      
      button {
        padding: 12px 15px;
        font-size: 0.9rem;
      }
      
      .user-type {
        max-width: 350px;
      }
      
      .cart-panel {
        right: 20px;
        bottom: 20px;
      }
      
      .cart-toggle {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Login Modal -->
  <div class="modal" id="login-modal">
    <div class="modal-content">
      <h2 class="modal-title">STAFF LOGIN</h2>
      <div class="input-group">
        <label for="password">Enter Password:</label>
        <input type="password" id="password" placeholder="Your secure password">
      </div>
      <div class="modal-buttons">
        <button onclick="checkPassword()" style="flex: 1;">ENTER</button>
        <button onclick="closeModal()" style="background: var(--red); flex: 1;">CANCEL</button>
      </div>
    </div>
  </div>

  <!-- Table Number Modal -->
  <div class="table-number-modal" id="table-number-modal">
    <div class="table-number-content">
      <h2 class="table-number-title">YOUR TABLE NUMBER</h2>
      <input type="number" class="table-number-input" id="table-number-input" placeholder="Enter table number" min="1">
      <div class="modal-buttons">
        <button onclick="confirmOrderWithTable()" style="flex: 1;">CONFIRM</button>
        <button onclick="closeTableModal()" style="background: var(--red); flex: 1;">CANCEL</button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="overlay" id="main-content">
    <!-- User Type Selection -->
    <div class="user-type">
      <button class="user-btn active" id="guest-btn">GUEST</button>
      <button class="user-btn" id="staff-btn">STAFF</button>
    </div>

    <!-- Guest View -->
    <div id="guest-view">
      <div class="header">
        <img src="images-removebg-preview (1).png" alt="The Oak Cafe Logo" class="logo">
        <h1>TASTE ITALY IN 3D</h1>
        <p class="tagline">SCAN • TAP • SAVOR</p>
      </div>

      <div class="food-container">
        <h2 class="food-title" id="food-title">Margherita Pizza</h2>
        <p class="food-desc" id="food-desc">San Marzano tomato sauce, fresh mozzarella, basil</p>
        <model-viewer
          id="model-viewer"
          src="models/Margherita Pizza.glb"
          ar
          ar-modes="quick-look scene-viewer webxr"
          camera-controls
          auto-rotate
          shadow-intensity="1.2"
          exposure="1.1"
        >
          <button slot="ar-button" class="ar-button">VIEW IN YOUR SPACE</button>
        </model-viewer>

        <button class="add-to-cart" id="add-to-cart">ADD TO ORDER - 5.99 JD</button>

        <div class="nav-buttons">
          <button id="prev-btn">← PREV</button>
          <span id="counter">1/6</span>
          <button id="next-btn">NEXT →</button>
        </div>

        <!-- Client Order Status Section -->
        <button class="view-orders-btn" id="view-orders-btn">VIEW MY ORDERS</button>
        <div class="client-orders" id="client-orders">
          <h3>YOUR ORDERS</h3>
          <div id="client-orders-list">
            <!-- Client orders will appear here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Staff Dashboard -->
    <div class="staff-dashboard" id="staff-dashboard">
      <h2 style="color: var(--gold);">ORDERS DASHBOARD</h2>
      <div class="orders-list" id="orders-list">
        <!-- Orders will appear here -->
      </div>
    </div>

    <div class="footer">
      <div class="footer-grid">
        <div class="branding-section">
          <div class="powered-by">
            <span style="color: var(--light-cream);">Powered by</span>
            <img src="ar-bites-logo.png" alt="AR Bites Logo" class="ar-bites-logo">
          </div>
          <p class="copyright">© 2025 AR BITES. ALL RIGHTS RESERVED</p>
        </div>
        
        <div class="social-links">
          <a href="https://www.instagram.com/ar.bitesjo?igsh=ajhmd3ZvbjJhamJh" class="social-link" target="_blank">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/2048px-Instagram_icon.png" alt="Instagram" class="instagram-icon">
            @ar.bitesjo
          </a>
          <a href="tel:+962790753376" class="social-link">
            <img src="https://cdn-icons-png.flaticon.com/512/455/455705.png" alt="Phone" class="instagram-icon">
            +962 790 753 376
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Panel -->
  <div class="cart-panel" id="cart-panel">
    <div class="cart-header">
      <h3>YOUR ORDER</h3>
      <button id="close-cart">×</button>
    </div>
    <div class="cart-items" id="cart-items"></div>
    <div class="cart-total" id="cart-total">Total: 0.00 JD</div>
    <button class="checkout-btn" id="checkout-btn">
      <span class="checkout-text">CONFIRM ORDER</span>
    </button>
  </div>

  <!-- Cart Toggle Button -->
  <div class="cart-toggle" id="cart-toggle">
    <span class="cart-count" id="cart-count">0</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="9" cy="21" r="1"></circle>
      <circle cx="20" cy="21" r="1"></circle>
      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
    </svg>
  </div>

  <!-- Order Status Notification -->
  <div class="order-status-notification" id="order-status">
    <img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Status" class="status-icon">
    <div class="status-content">
      <div class="status-title">ORDER RECEIVED</div>
      <div class="status-message">Your order is being prepared</div>
    </div>
    <button class="close-status" id="close-status">×</button>
  </div>

  <script>
    // ==================== FIREBASE CONFIG ====================
    const firebaseConfig = {
      apiKey: "AIzaSyD5bF7rsIhlJ0-EBdRTHH67quCzjOFCRdQ",
      authDomain: "the-oak-cafe.firebaseapp.com",
      projectId: "the-oak-cafe",
      storageBucket: "the-oak-cafe.appspot.com",
      messagingSenderId: "871343311823",
      appId: "1:871343311823:web:eb6724643e10cafde9e0ba",
      measurementId: "G-G83C83HXWR"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const analytics = firebase.analytics();

    // ==================== APP DATA ====================
    const foods = [
      {
        title: "Margherita Pizza",
        description: "San Marzano tomato sauce, fresh mozzarella, basil",
        model: "models/Margherita Pizza.glb",
        price: 5.99
      },
      {
        title: "Pepperoni Pizza",
        description: "Spicy pepperoni, mozzarella, tomato sauce",
        model: "models/Pepperoni Pizza.glb",
        price: 6.99
      },
      {
        title: "Truffle Fettuccine",
        description: "Handmade pasta, black truffle, parmesan cream",
        model: "models/Fettuccine Alfredo.glb",
        price: 7.99
      },
      {
        title: "Genovese Pesto",
        description: "Basil pesto, pine nuts, aged parmesan",
        model: "models/Pesto Pasta.glb",
        price: 7.49
      },
      {
        title: "Rosa Pasta",
        description: "Creamy tomato sauce, pancetta, pecorino",
        model: "models/Rose Pasta.glb",
        price: 7.99
      },
      {
        title: "Frutti Di Mare",
        description: "Clams, mussels, shrimp in white wine sauce",
        model: "models/Sea Food Pasta.glb",
        price: 8.99
      }
    ];

    // ==================== GLOBAL VARIABLES ====================
    let currentIndex = 0;
    let cart = [];
    let orders = [];
    let isStaff = false;
    let clientId = localStorage.getItem('clientId') || 
                  'CL-' + Math.random().toString(36).substr(2, 6).toUpperCase();
    let firestoreListener = null;

    // DOM Elements
    const modelViewer = document.getElementById("model-viewer");
    const foodTitle = document.getElementById("food-title");
    const foodDesc = document.getElementById("food-desc");
    const counter = document.getElementById("counter");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const addToCartBtn = document.getElementById("add-to-cart");
    const guestBtn = document.getElementById("guest-btn");
    const staffBtn = document.getElementById("staff-btn");
    const guestView = document.getElementById("guest-view");
    const staffDashboard = document.getElementById("staff-dashboard");
    const loginModal = document.getElementById("login-modal");
    const ordersList = document.getElementById("orders-list");
    const cartPanel = document.getElementById("cart-panel");
    const cartItemsEl = document.getElementById("cart-items");
    const cartTotalEl = document.getElementById("cart-total");
    const checkoutBtn = document.getElementById("checkout-btn");
    const checkoutText = document.querySelector(".checkout-text");
    const cartToggle = document.getElementById("cart-toggle");
    const cartCount = document.getElementById("cart-count");
    const closeCartBtn = document.getElementById("close-cart");
    const orderStatus = document.getElementById("order-status");
    const closeStatusBtn = document.getElementById("close-status");
    const viewOrdersBtn = document.getElementById("view-orders-btn");
    const clientOrders = document.getElementById("client-orders");
    const clientOrdersList = document.getElementById("client-orders-list");
    const tableNumberModal = document.getElementById("table-number-modal");
    const tableNumberInput = document.getElementById("table-number-input");

    // Password - CHANGE THIS TO YOUR SECURE PASSWORD
    const STAFF_PASSWORD = "OakCafe2025";
    const STAFF_TOKEN = "staff-auth-token";

    // ==================== CHECKOUT WITH TABLE NUMBER ====================
    async function confirmOrderWithTable() {
      const tableNumber = tableNumberInput.value.trim();
      if (!tableNumber || isNaN(tableNumber) || parseInt(tableNumber) <= 0) {
        alert("Please enter a valid table number");
        return;
      }
      
      closeTableModal();
      await checkout(tableNumber);
    }

    function showTableModal() {
      tableNumberInput.value = "";
      tableNumberModal.style.display = "flex";
    }

    function closeTableModal() {
      tableNumberModal.style.display = "none";
    }

    // ==================== OPTIMIZED CHECKOUT FUNCTION ====================
    async function checkout(tableNumber = null) {
      if (cart.length === 0) return;
      
      checkoutBtn.disabled = true;
      checkoutBtn.classList.add('checkout-loading');
      
      try {
        const order = {
          id: 'ORD-' + Date.now().toString().substr(-6),
          items: [...cart],
          total: cart.reduce((sum, item) => sum + item.price, 0),
          status: 'pending',
          clientId: clientId,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          tableNumber: tableNumber || "Not specified"
        };

        // Add the order and get the document reference
        const docRef = await db.collection("orders").add(order);
        
        // Store both the order ID and document ID
        await docRef.update({ 
          documentId: docRef.id  // Store the Firestore-generated ID
        });

        cart = [];
        updateCart();
        cartPanel.classList.remove('active');
        showOrderStatus(`Order #${order.id} confirmed!`, "ORDER CONFIRMED");
        
        analytics.logEvent('purchase', {
          transaction_id: order.id,
          value: order.total,
          currency: 'JD',
          items: order.items.length
        });
        
      } catch (error) {
        console.error("Checkout error:", error);
        showOrderStatus("Failed to place order. Please try again.", "ORDER ERROR");
      } finally {
        checkoutBtn.disabled = false;
        checkoutBtn.classList.remove('checkout-loading');
      }
    }

    // ==================== IMPROVED FIREBASE FUNCTIONS ====================
    function setupRealTimeListener() {
      if (firestoreListener) {
        firestoreListener();
      }
      
      firestoreListener = db.collection("orders")
        .orderBy("timestamp", "desc")
        .onSnapshot((snapshot) => {
          const updatedOrders = [];
          snapshot.forEach((doc) => {
            updatedOrders.push({ 
              id: doc.data().id, // Use our custom ORD-123 ID
              documentId: doc.id, // Store Firestore document ID
              ...doc.data() 
            });
          });
          
          orders = updatedOrders;
          
          if (isStaff) {
            renderOrders();
          }
          
          renderClientOrders(orders.filter(o => o.clientId === clientId));
        }, (error) => {
          console.error("Firestore listener error:", error);
          showOrderStatus("Connection issue. Trying to reconnect...", "NETWORK ERROR");
          setTimeout(setupRealTimeListener, 2000);
        });
    }

    // ==================== CORE FUNCTIONS ====================
    function updateModel() {
      const food = foods[currentIndex];
      modelViewer.src = food.model;
      foodTitle.textContent = food.title;
      foodDesc.textContent = food.description;
      counter.textContent = `${currentIndex + 1}/${foods.length}`;
      addToCartBtn.textContent = `ADD TO ORDER - ${food.price.toFixed(2)} JD`;
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === foods.length - 1;
    }

    function addToCart() {
      const currentFood = foods[currentIndex];
      cart.push({
        ...currentFood,
        id: Date.now() + Math.random().toString(36).substr(2, 9)
      });
      updateCart();
      showOrderStatus(`${currentFood.title} added to order`, "ORDER UPDATED");
      cartPanel.classList.add("active");
      
      analytics.logEvent('add_to_cart', {
        items: cart.length,
        item_name: currentFood.title,
        value: currentFood.price
      });
    }

    function removeFromCart(itemId) {
      cart = cart.filter(item => item.id !== itemId);
      updateCart();
    }

    function updateCart() {
      cartItemsEl.innerHTML = '';
      let total = 0;
      
      cart.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'cart-item';
        itemEl.innerHTML = `
          <span class="item-name">${item.title}</span>
          <span class="item-price">${item.price.toFixed(2)} JD</span>
          <button class="remove-item" data-id="${item.id}">×</button>
        `;
        cartItemsEl.appendChild(itemEl);
        total += item.price;
      });
      
      cartTotalEl.textContent = `Total: ${total.toFixed(2)} JD`;
      cartCount.textContent = cart.length;
      
      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', (e) => {
          removeFromCart(e.target.dataset.id);
        });
      });
    }

    function renderOrders() {
      ordersList.innerHTML = '';
      
      if (orders.length === 0) {
        ordersList.innerHTML = '<p style="color: var(--light-cream);">No orders yet</p>';
        return;
      }
      
      const sortedOrders = [...orders].sort((a, b) => {
        const statusOrder = {pending: 0, preparing: 1, ready: 2, completed: 3};
        if (statusOrder[a.status] !== statusOrder[b.status]) {
          return statusOrder[a.status] - statusOrder[b.status];
        }
        return b.timestamp?.toMillis() - a.timestamp?.toMillis();
      });
      
      sortedOrders.forEach(order => {
        const orderEl = document.createElement('div');
        orderEl.className = 'order-card';
        
        // Create buttons with proper event handlers
        const preparingBtn = document.createElement('button');
        preparingBtn.className = 'action-btn';
        preparingBtn.style.background = '#2196F3';
        preparingBtn.style.color = 'white';
        preparingBtn.textContent = 'Preparing';
        preparingBtn.onclick = () => updateOrderStatus(order.id, 'preparing');
        
        const readyBtn = document.createElement('button');
        readyBtn.className = 'action-btn';
        readyBtn.style.background = '#4CAF50';
        readyBtn.style.color = 'white';
        readyBtn.textContent = 'Ready';
        readyBtn.onclick = () => updateOrderStatus(order.id, 'ready');
        
        const completeBtn = document.createElement('button');
        completeBtn.className = 'action-btn';
        completeBtn.style.background = '#9E9E9E';
        completeBtn.style.color = 'white';
        completeBtn.textContent = 'Complete';
        completeBtn.onclick = () => updateOrderStatus(order.id, 'completed');
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'action-btn delete-order';
        deleteBtn.textContent = 'DELETE ORDER';
        deleteBtn.onclick = () => deleteOrder(order.id);
        
        // Create actions container
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'order-actions';
        actionsDiv.appendChild(preparingBtn);
        actionsDiv.appendChild(readyBtn);
        actionsDiv.appendChild(completeBtn);
        
        // Build order card
        orderEl.innerHTML = `
          <div class="order-header">
            <div class="order-id">Order #${order.id} (Table ${order.tableNumber})</div>
            <div class="order-status status-${order.status}">${order.status.toUpperCase()}</div>
          </div>
          <div class="order-items">
            ${order.items.map(item => `
              <div class="order-item">
                <span>${item.title}</span>
                <span>${item.price.toFixed(2)} JD</span>
              </div>
            `).join('')}
          </div>
          <div style="text-align: right; font-weight: bold; color: var(--gold);">
            Total: ${order.total.toFixed(2)} JD
          </div>
        `;
        
        // Append dynamically created buttons
        orderEl.appendChild(actionsDiv);
        orderEl.appendChild(deleteBtn);
        
        ordersList.appendChild(orderEl);
      });
    }

    async function updateOrderStatus(orderId, status) {
      try {
        // Find the document that contains this order ID
        const querySnapshot = await db.collection("orders")
          .where("id", "==", orderId)
          .limit(1)
          .get();

        if (querySnapshot.empty) {
          throw new Error("Order not found");
        }

        // Get the actual document reference
        const docRef = querySnapshot.docs[0].ref;
        
        await docRef.update({ 
          status: status,
          timestamp: firebase.firestore.FieldValue.serverTimestamp() 
        });

        // Update notification
        const statusMessages = {
          preparing: `Your order #${orderId} is being prepared`,
          ready: `Your order #${orderId} is ready!`,
          completed: `Your order #${orderId} has been completed`
        };
        
        if (statusMessages[status]) {
          showOrderStatus(statusMessages[status], "ORDER UPDATE");
        }
        
      } catch (error) {
        console.error("Update error:", error);
        showOrderStatus(
          error.message.includes("not found") ? "Order not found" : "Update failed. Try again.",
          "UPDATE ERROR"
        );
      }
    }

    async function deleteOrder(orderId) {
      if (!confirm("Permanently delete this order?")) return;

      try {
        // Find the document containing this order ID
        const querySnapshot = await db.collection("orders")
          .where("id", "==", orderId)
          .limit(1)
          .get();

        if (querySnapshot.empty) {
          throw new Error("Order not found");
        }

        // Delete using the document reference
        await querySnapshot.docs[0].ref.delete();
        showOrderStatus(`Order #${orderId} deleted`, "ORDER DELETED");
        
      } catch (error) {
        console.error("Delete error:", error);
        showOrderStatus(
          error.message.includes("not found") ? "Order not found" : "Delete failed. Try again.",
          "DELETE ERROR"
        );
      }
    }

    function renderClientOrders(clientOrdersData) {
      clientOrdersList.innerHTML = '';
      
      if (clientOrdersData.length === 0) {
        clientOrdersList.innerHTML = '<p style="color: var(--light-cream);">No orders yet</p>';
        return;
      }
      
      clientOrdersData.forEach(order => {
        const orderEl = document.createElement('div');
        orderEl.className = 'client-order';
        orderEl.innerHTML = `
          <div class="client-order-header">
            <div class="client-order-id">#${order.id}</div>
            <div class="client-order-status status-${order.status}">${order.status.toUpperCase()}</div>
          </div>
          <div class="client-order-items">
            ${order.items.map(item => `
              <div class="client-order-item">
                <span>${item.title}</span>
                <span>${item.price.toFixed(2)} JD</span>
              </div>
            `).join('')}
          </div>
          <div class="client-order-total">Total: ${order.total.toFixed(2)} JD</div>
        `;
        clientOrdersList.appendChild(orderEl);
      });
    }

    function showOrderStatus(message, title = "ORDER RECEIVED") {
      const statusTitle = orderStatus.querySelector(".status-title");
      const statusMessage = orderStatus.querySelector(".status-message");
      
      statusTitle.textContent = title;
      statusMessage.textContent = message;
      orderStatus.classList.add("active");
      
      setTimeout(() => {
        orderStatus.classList.remove("active");
      }, 5000);
    }

    function checkPassword() {
      const passwordInput = document.getElementById("password");
      if (passwordInput.value === STAFF_PASSWORD) {
        isStaff = true;
        localStorage.setItem(STAFF_TOKEN, 'true');
        checkAuthState();
        closeModal();
        
        analytics.logEvent('staff_login');
      } else {
        alert("Incorrect password. Please try again.");
        passwordInput.value = "";
      }
    }

    function checkAuthState() {
      if (isStaff) {
        guestBtn.classList.remove("active");
        staffBtn.classList.add("active");
        guestView.style.display = "none";
        staffDashboard.style.display = "block";
      }
    }

    function closeModal() {
      loginModal.style.display = "none";
      document.getElementById("password").value = "";
    }

    // ==================== EVENT LISTENERS ====================
    document.addEventListener('DOMContentLoaded', () => {
      try {
        if (!localStorage.getItem('clientId')) {
          clientId = 'CL-' + Math.random().toString(36).substr(2, 6).toUpperCase();
          localStorage.setItem('clientId', clientId);
        }
        
        isStaff = localStorage.getItem(STAFF_TOKEN) === 'true';
        checkAuthState();
        
        setupRealTimeListener();
        updateModel();
        updateCart();
        
        analytics.logEvent('page_view');
      } catch (error) {
        console.error("Initialization error:", error);
        showOrderStatus("System loading... Please wait", "LOADING");
        setTimeout(() => window.location.reload(), 3000);
      }
    });

    // Button event listeners
    addToCartBtn.addEventListener('click', addToCart);
    checkoutBtn.addEventListener('click', showTableModal);
    closeStatusBtn.addEventListener('click', () => orderStatus.classList.remove('active'));
    cartToggle.addEventListener('click', () => cartPanel.classList.toggle('active'));
    closeCartBtn.addEventListener('click', () => cartPanel.classList.remove('active'));
    viewOrdersBtn.addEventListener('click', () => {
      clientOrders.classList.toggle('active');
      viewOrdersBtn.textContent = clientOrders.classList.contains('active') ? 
        'HIDE MY ORDERS' : 'VIEW MY ORDERS';
    });

    // Navigation buttons
    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateModel();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentIndex < foods.length - 1) {
        currentIndex++;
        updateModel();
      }
    });

    // User type switching
    guestBtn.addEventListener('click', () => {
      guestBtn.classList.add('active');
      staffBtn.classList.remove('active');
      guestView.style.display = 'block';
      staffDashboard.style.display = 'none';
      isStaff = false;
      localStorage.removeItem(STAFF_TOKEN);
    });

    staffBtn.addEventListener('click', () => {
      if (isStaff) {
        guestBtn.classList.remove('active');
        staffBtn.classList.add('active');
        guestView.style.display = 'none';
        staffDashboard.style.display = 'block';
      } else {
        loginModal.style.display = 'flex';
      }
    });

    // Initialize cart
    updateCart();
  </script>
</body>
</html>
